<!-- SPDX-License-Identifier: AGPL-3.0-or-later -->
<div class="chat-history-messages">
  <ng-container *ngIf="messagesGroupedByDate$ | async as messages">
    <ng-container *ngFor="let entry of messages; trackBy: trackByIndex">
      <div class="chat-messages-date-group">
        {{
          entry.date
            | date: chatService.translations.dateFormat : undefined : chatService.translations.locale
        }}
      </div>
      <div class="chat-messages-group">
        <ng-container *ngFor="let message of entry.messages; trackBy: trackByMessage">
          <div class="chat-message-wrapper" [class.incoming]="isIncomingMessage(message)" [class.outgoing]="isOutgoingMessage(message)">
            <ngx-chat-message-in
              *ngIf="isIncomingMessage(message)"
              [showAvatar]="showAvatars"
              [message]="message"
              [contact]="contact"
            />
            <ngx-chat-message-out
              *ngIf="isOutgoingMessage(message)"
              [showAvatar]="showAvatars"
              [message]="message"
              [contact]="contact"
            />
          </div>
        </ng-container>
      </div>
    </ng-container>
  </ng-container>

  <!-- Debug info -->
  <div *ngIf="messagesGroupedByDate$ | async as messages" style="display: none;">
    Debug info:
    <div *ngFor="let entry of messages">
      Date: {{entry.date | date}}
      <div *ngFor="let message of entry.messages">
        Message: {{message.body}} 
        Direction: {{message.direction}}
        From: {{message.from}}
        DateTime: {{message.datetime | date:'medium'}}
      </div>
    </div>
  </div>
</div>
